{% extends "base.html" %} {% block content %} <h2>{{ event.event }}</h2>
<hr>
{% if participants %}
<!-- Tabs Nav -->
<ul class="nav nav-tabs" id="participantTabs" role="tablist"> {% for p in participants %} <li class="nav-item" role="presentation">
    <button class="
                    nav-link 
                    {% if active_tab == 'tab-'|add:p.id|stringformat:'s' %}
                        active
                    {% elif forloop.first and not active_tab %}
                        active
                    {% endif %}" id="tab-{{ p.id }}" data-bs-toggle="tab" data-bs-target="#content-{{ p.id }}" type="button" role="tab" href="#content-{{ p.id }}">
      {{ p.recipient.name }}
    </button>
  </li> {% endfor %} <li>
    <button class="btn ms-2" data-bs-toggle="modal" data-bs-target="#addModal" onclick="openModal('Add Participant', `{% url 'add_participant' event.id %}`)"> Add Person + </button>
  </li>
</ul>
<!-- Tab Content -->
<div class="tab-content mt-3"> {% for p in participants %} <div class="tab-pane fade 
            {% if active_tab == 'tab-'|add:p.id|stringformat:'s' %}
                show active
            {% elif forloop.first and not active_tab %}
                show active
            {% endif %}" id="content-{{ p.id }}" role="tabpanel">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal" onclick="openModal('Add Gift for {{ p.recipient.name }}', `{% url 'add_gift' p.id %}`)"> Add New Gift + </button>
        <button class="btn btn-primary" data-bs-toggle="offcanvas" data-bs-target="#wishlistOffcanvas{{ p.id }}" aria-controls="wishlistOffcanvas"> Move Gift From Wish List + </button>
      <h5 class="mb-0"> {% if p.budget %} <span class="text-muted small">Budget: ${{ p.budget.price|floatformat:2 }}</span> {% endif %} </h5>
      <h5 class="mb-0">
        <span class="text-muted small">Total Spent: ${{ p.spent|floatformat:2 }} {% if p.budget %}</span>
      </h5>
      <h5 class="mb-0">
        <span class="text-muted small">Remaining: ${{ p.remaining|floatformat:2 }}</span>
      </h5> {% endif %}
      <!-- Dropdown for Edit/Delete -->
      <div class="dropdown">
        <button class="btn btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown"> ... </button>
        <ul class="dropdown-menu">
            <li>
            <button class="dropdown-item" data-bs-toggle="modal" data-bs-target="#addModal" onclick="openModal('Edit Participant', `{% url 'edit_participant' p.id %}`)"> Edit </button>
            </li>
          <li>
            <button class="dropdown-item" data-bs-toggle="modal" data-bs-target="#deleteModal" onclick="openDeleteModal('/participant/{{ p.id }}/delete/', 'participant')"> Delete </button>
          </li>
        </ul>
      </div>
    </div> {% if p.gift_set.all %} <ul class="list-group mb-3"> {% for gift in p.gift_set.all %} <li class="list-group-item d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-2">
        <div class="d-flex align-items-center gap-3"> {% if gift.product_image %} <img src="{{ gift.product_image }}" alt="{{ gift.product_name }}" class="img-thumbnail" style="width: 80px; height: auto;"> {% endif %} <div class="d-flex flex-column"> {% if gift.product_name %} <a href="{{ gift.item_url }}" class="fw-semibold text-decoration-none text-primary" target="_blank">
              {{ gift.product_name }}
            </a> {% else %} <a href="{{ gift.item_url }}" class="fw-semibold text-decoration-none text-primary" target="_blank">
              {{ gift.item_url }}
            </a> {% endif %} {% if gift.product_price %} <span class="text-muted small">${{ gift.product_price }}</span> {% endif %} </div>
          <input type="checkbox" class="form-check-input delete-checkbox d-none" value="{{ gift.id }}">
        </div>
      </li> {% endfor %} </ul> {% else %} <p class="text-muted fst-italic">No gifts added yet.</p> {% endif %}
  </div> {% endfor %} </div> {% else %} <p>No participants yet.</p> {% endif %} {% endblock %}